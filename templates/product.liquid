{% comment %}
  Product Template
  Shows single product with gallery, info, and add to cart
{% endcomment %}

<!-- Breadcrumb -->
<div class="breadcrumb-bar">
  <div class="page-width">
    <nav class="breadcrumb">
      <a href="{{ routes.root_url }}">Home</a>
      <span class="breadcrumb__separator">/</span>
      {% if collection %}
        <a href="{{ collection.url }}">{{ collection.title }}</a>
        <span class="breadcrumb__separator">/</span>
      {% endif %}
      <span class="breadcrumb__current">{{ product.title }}</span>
    </nav>
  </div>
</div>

<!-- Product Section -->
<section class="product-section">
  <div class="page-width">
    <div class="product-layout">
      <!-- Gallery -->
      <div class="product-gallery">
        <div class="product-gallery__main">
          {% if product.featured_image %}
            <img src="{{ product.featured_image | image_url: width: 800 }}" alt="{{ product.title }}" id="mainImage">
          {% else %}
            <div class="product-gallery__placeholder">
              <svg width="64" height="64" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              </svg>
            </div>
          {% endif %}
          {% if product.compare_at_price > product.price %}
            <span class="product-gallery__badge">Sale</span>
          {% endif %}
        </div>
        {% if product.images.size > 1 %}
          <div class="product-gallery__thumbs">
            {% for image in product.images limit: 5 %}
              <button class="product-gallery__thumb {% if forloop.first %}active{% endif %}" data-image="{{ image | image_url: width: 800 }}">
                <img src="{{ image | image_url: width: 150 }}" alt="{{ product.title }}">
              </button>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Info -->
      <div class="product-info">
        <h1 class="product-info__title">{{ product.title }}</h1>
        
        <div class="product-info__price">
          <span class="product-info__price-current">{{ product.price | money }}</span>
          {% if product.compare_at_price > product.price %}
            <span class="product-info__price-compare">{{ product.compare_at_price | money }}</span>
            <span class="product-info__price-save">Save {{ product.compare_at_price | minus: product.price | money }}</span>
          {% endif %}
        </div>

        {% if product.description != blank %}
          <div class="product-info__desc">{{ product.description }}</div>
        {% endif %}

        <form action="/cart/add" method="post" class="product-form">
          {% unless product.has_only_default_variant %}
            {% for option in product.options_with_values %}
              <div class="product-form__group">
                <label class="product-form__label">{{ option.name }}</label>
                <select name="id" class="product-form__select">
                  {% for variant in product.variants %}
                    <option value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}selected{% endif %}>
                      {{ variant.title }} - {{ variant.price | money }}
                    </option>
                  {% endfor %}
                </select>
              </div>
            {% endfor %}
          {% else %}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          {% endunless %}

          <div class="product-form__group">
            <label class="product-form__label">Quantity</label>
            <div class="product-form__qty">
              <button type="button" class="product-form__qty-btn" onclick="changeQty(-1)">âˆ’</button>
              <input type="number" name="quantity" value="1" min="1" class="product-form__qty-input" id="qtyInput">
              <button type="button" class="product-form__qty-btn" onclick="changeQty(1)">+</button>
            </div>
          </div>

          <button type="submit" class="button button--primary product-form__submit">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            Add to Cart
          </button>
        </form>

        <div class="product-features">
          <div class="product-features__item">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
              <rect x="1" y="3" width="15" height="13"></rect>
              <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
              <circle cx="5.5" cy="18.5" r="2.5"></circle>
              <circle cx="18.5" cy="18.5" r="2.5"></circle>
            </svg>
            <span>Free Shipping</span>
          </div>
          <div class="product-features__item">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            <span>Secure Payment</span>
          </div>
          <div class="product-features__item">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
              <polyline points="23 4 23 10 17 10"></polyline>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
            </svg>
            <span>30-Day Returns</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
function changeQty(delta) {
  const input = document.getElementById('qtyInput');
  const val = parseInt(input.value) + delta;
  if (val >= 1) input.value = val;
}

document.querySelectorAll('.product-gallery__thumb').forEach(thumb => {
  thumb.addEventListener('click', function() {
    const main = document.getElementById('mainImage');
    if (main) {
      main.src = this.dataset.image;
      document.querySelectorAll('.product-gallery__thumb').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
    }
  });
});
</script>

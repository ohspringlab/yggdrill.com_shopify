{% comment %}
  Product Template - Matches yggdrill.com design
{% endcomment %}

<!-- Breadcrumb Bar -->
<div class="breadcrumb-bar">
  <div class="page-width">
    <nav class="breadcrumb">
      <a href="{{ routes.root_url }}">Home</a>
      <span class="breadcrumb__separator">/</span>
      {% if product.collections.size > 0 %}
        <a href="{{ product.collections.first.url }}">{{ product.collections.first.title }}</a>
        <span class="breadcrumb__separator">/</span>
      {% endif %}
      <span class="breadcrumb__current">{{ product.title }}</span>
    </nav>
    <div class="breadcrumb-nav">
      <a href="#" class="breadcrumb-nav__link">‚Äπ</a>
      <span class="breadcrumb-nav__grid">‚äû</span>
      <a href="#" class="breadcrumb-nav__link">‚Ä∫</a>
    </div>
  </div>
</div>

<!-- Product Section -->
<section class="product-page">
  <div class="page-width">
    <div class="product-layout">
      <!-- Product Gallery -->
      <div class="product-gallery">
        <div class="product-gallery__main">
          <!-- Yggdrill Watermark -->
          <div class="product-gallery__watermark">
            <img src="https://yggdrill.com/wp-content/uploads/2025/10/logo.png" alt="Yggdrill">
          </div>
          <!-- Orange Corners -->
          <div class="product-gallery__corner product-gallery__corner--tl"></div>
          <div class="product-gallery__corner product-gallery__corner--tr"></div>
          <div class="product-gallery__corner product-gallery__corner--bl"></div>
          <div class="product-gallery__corner product-gallery__corner--br"></div>
          <!-- HOT Badge -->
          {% if product.compare_at_price > product.price %}
            <span class="product-gallery__badge">HOT</span>
          {% endif %}
          <!-- Main Image -->
          {% if product.featured_image %}
            <img src="{{ product.featured_image | image_url: width: 800 }}" alt="{{ product.title }}" id="mainProductImage" class="product-gallery__image">
          {% else %}
            <div class="product-gallery__placeholder">
              <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1">
                <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
            </div>
          {% endif %}
          <!-- Orange Plus Icons -->
          <span class="product-gallery__plus product-gallery__plus--top">+</span>
          <span class="product-gallery__plus product-gallery__plus--right">+</span>
          <span class="product-gallery__plus product-gallery__plus--bottom">+</span>
        </div>
        <!-- Thumbnails -->
        {% if product.images.size > 1 %}
          <div class="product-gallery__thumbs">
            {% for image in product.images limit: 5 %}
              <button class="product-gallery__thumb {% if forloop.first %}active{% endif %}" data-image="{{ image | image_url: width: 800 }}">
                <img src="{{ image | image_url: width: 100 }}" alt="{{ product.title }}">
              </button>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Product Info -->
      <div class="product-info">
        <h1 class="product-info__title">{{ product.title }}</h1>
        
        <!-- Rating -->
        <div class="product-info__rating">
          <span class="product-info__stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
          <span class="product-info__reviews">({{ product.metafields.reviews.rating.value | default: 1 }} Reviews)</span>
        </div>

        <!-- Price -->
        <div class="product-info__price">
          <span class="product-info__price-amount">{{ product.price | money_without_trailing_zeros }}</span>
          <span class="product-info__price-currency">kr</span>
          {% if product.compare_at_price > product.price %}
            <span class="product-info__price-compare">({{ product.compare_at_price | money_without_trailing_zeros }})</span>
          {% endif %}
          <span class="product-info__price-vat">Excl. VAT</span>
        </div>

        <!-- Short Description -->
        <div class="product-info__desc">
          {{ product.description | strip_html | truncate: 300 }}
        </div>

        <!-- Open Source Note -->
        <div class="product-info__opensource">
          <span>üè†</span> This miner is open source. <a href="#">View the code or contribute on GitHub</a>.
        </div>

        <!-- Add to Cart Form -->
        <form action="/cart/add" method="post" class="product-form">
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          
          <div class="product-form__row">
            <!-- Quantity -->
            <div class="product-form__qty">
              <button type="button" class="product-form__qty-btn" onclick="changeProductQty(-1)">-</button>
              <input type="number" name="quantity" value="1" min="1" class="product-form__qty-input" id="productQtyInput">
              <button type="button" class="product-form__qty-btn" onclick="changeProductQty(1)">+</button>
            </div>
            
            <!-- Add to Cart -->
            <button type="submit" class="product-form__add-btn">Add To Cart</button>
            
            <!-- Buy Now -->
            <button type="submit" name="checkout" class="product-form__buy-btn">Buy Now</button>
          </div>
        </form>

        <!-- Klarna -->
        <div class="product-info__klarna">
          Pay later with <strong>Klarna</strong> <a href="#">Learn more</a>
        </div>

        <!-- Features -->
        <div class="product-features">
          <div class="product-features__item">
            <div class="product-features__icon">üöö</div>
            <div>
              <strong>Fast Delivery</strong>
              <p>Quick, reliable shipping to any location.</p>
            </div>
          </div>
          <div class="product-features__item">
            <div class="product-features__icon">‚Ü©Ô∏è</div>
            <div>
              <strong>Free & easy returns</strong>
              <p>Return this item by mail within 14 days for a full refund.</p>
            </div>
          </div>
        </div>

        <!-- Accordions -->
        <div class="product-accordions">
          <details class="product-accordion">
            <summary class="product-accordion__header">
              <span>Description</span>
              <span class="product-accordion__icon">‚Ä∫</span>
            </summary>
            <div class="product-accordion__content">
              {{ product.description }}
            </div>
          </details>
          <details class="product-accordion">
            <summary class="product-accordion__header">
              <span>Additional information</span>
              <span class="product-accordion__icon">‚Ä∫</span>
            </summary>
            <div class="product-accordion__content">
              <p>SKU: {{ product.variants.first.sku | default: 'N/A' }}</p>
              <p>Vendor: {{ product.vendor }}</p>
              <p>Type: {{ product.type }}</p>
            </div>
          </details>
          <details class="product-accordion">
            <summary class="product-accordion__header">
              <span>Reviews</span>
              <span class="product-accordion__icon">‚Ä∫</span>
            </summary>
            <div class="product-accordion__content">
              <p>No reviews yet. Be the first to review this product!</p>
            </div>
          </details>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Related Products -->
<section class="related-products">
  <div class="page-width">
    <h2 class="related-products__title">Related products</h2>
    <div class="related-products__grid">
      {% assign related_collection = product.collections.first %}
      {% if related_collection %}
        {% for related_product in related_collection.products limit: 4 %}
          {% unless related_product.id == product.id %}
            {% render 'product-card', product: related_product, index: forloop.index %}
          {% endunless %}
        {% endfor %}
      {% endif %}
    </div>
  </div>
</section>

<script>
function changeProductQty(delta) {
  const input = document.getElementById('productQtyInput');
  const val = parseInt(input.value) + delta;
  if (val >= 1) input.value = val;
}

document.querySelectorAll('.product-gallery__thumb').forEach(thumb => {
  thumb.addEventListener('click', function() {
    const main = document.getElementById('mainProductImage');
    if (main) {
      main.src = this.dataset.image;
      document.querySelectorAll('.product-gallery__thumb').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
    }
  });
});
</script>

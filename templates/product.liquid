{% comment %}
  Product Template - Matches yggdrill.com design
{% endcomment %}

<!-- Breadcrumb Bar -->
<div class="breadcrumb-bar">
  <div class="page-width breadcrumb-bar__inner">
    <nav class="breadcrumb">
      <a href="{{ routes.root_url }}">Home</a>
      <span class="breadcrumb__separator">/</span>
      {% if product.collections.first %}
        <a href="{{ product.collections.first.url }}">{{ product.collections.first.title }}</a>
        <span class="breadcrumb__separator">/</span>
      {% endif %}
      <span class="breadcrumb__current">{{ product.title }}</span>
    </nav>
    <div class="breadcrumb-bar__nav">
      <a href="#" class="breadcrumb-bar__nav-link">‚Äπ</a>
      <span class="breadcrumb-bar__nav-icon">‚äû</span>
      <a href="#" class="breadcrumb-bar__nav-link">‚Ä∫</a>
    </div>
  </div>
</div>

<!-- Product Section -->
<section class="product-page">
  <div class="page-width">
    <div class="product-page__grid">
      <!-- Product Gallery -->
      <div class="product-gallery">
        <div class="product-gallery__main">
          <div class="product-gallery__watermark">
            <img src="https://yggdrill.com/wp-content/uploads/2025/10/logo.png" alt="Yggdrill">
          </div>
          <div class="product-gallery__corner product-gallery__corner--tl"></div>
          <div class="product-gallery__corner product-gallery__corner--tr"></div>
          <div class="product-gallery__corner product-gallery__corner--bl"></div>
          <div class="product-gallery__corner product-gallery__corner--br"></div>
          {% if product.compare_at_price > product.price %}
            <span class="product-gallery__badge">HOT</span>
          {% endif %}
          {% if product.featured_image %}
            <img src="{{ product.featured_image | image_url: width: 800 }}" alt="{{ product.title }}" id="mainProductImage" class="product-gallery__image">
          {% else %}
            <div class="product-gallery__placeholder">
              <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1">
                <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
            </div>
          {% endif %}
        </div>
        {% if product.images.size > 1 %}
          <div class="product-gallery__thumbs">
            {% for image in product.images limit: 5 %}
              <button class="product-gallery__thumb {% if forloop.first %}active{% endif %}" data-image="{{ image | image_url: width: 800 }}">
                <img src="{{ image | image_url: width: 100 }}" alt="{{ product.title }}">
              </button>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Product Info -->
      <div class="product-info">
        <h1 class="product-info__title">{{ product.title }}</h1>
        
        <div class="product-info__reviews">
          <span class="product-info__stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
          <span class="product-info__review-count">({{ product.metafields.reviews.rating.value | default: 1 }} Reviews)</span>
        </div>

        <div class="product-info__price">
          <span class="product-info__price-amount">{{ product.price | money_without_trailing_zeros }}</span>
          <span class="product-info__price-currency">kr</span>
          {% if product.compare_at_price > product.price %}
            <span class="product-info__price-compare">({{ product.compare_at_price | money_without_trailing_zeros }})</span>
          {% endif %}
          <span class="product-info__price-vat">Excl. VAT</span>
        </div>

        <div class="product-info__description">
          {{ product.description }}
        </div>

        {% if product.metafields.custom.open_source %}
          <div class="product-info__opensource">
            <span>üè†</span> This miner is open source. <a href="#">View the code or contribute on GitHub</a>.
          </div>
        {% endif %}

        <form action="/cart/add" method="post" class="product-form">
          {% unless product.has_only_default_variant %}
            {% for option in product.options_with_values %}
              <div class="product-form__option">
                <label class="product-form__label">{{ option.name }}</label>
                <select name="id" class="product-form__select">
                  {% for variant in product.variants %}
                    <option value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}selected{% endif %}>
                      {{ variant.title }} - {{ variant.price | money }}
                    </option>
                  {% endfor %}
                </select>
              </div>
            {% endfor %}
          {% else %}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          {% endunless %}

          <div class="product-form__actions">
            <div class="product-form__qty">
              <button type="button" class="product-form__qty-btn" onclick="changeProductQty(-1)">-</button>
              <input type="number" name="quantity" value="1" min="1" class="product-form__qty-input" id="productQtyInput">
              <button type="button" class="product-form__qty-btn" onclick="changeProductQty(1)">+</button>
            </div>
            <button type="submit" class="product-form__add-btn">Add To Cart</button>
            <button type="button" class="product-form__buy-btn" onclick="window.location.href='/checkout'">Buy Now</button>
          </div>
        </form>

        <div class="product-info__klarna">
          <span>Pay later with</span>
          <img src="https://x.klarnacdn.net/payment-method/assets/badges/generic/klarna.svg" alt="Klarna" height="20">
          <a href="#">Learn more</a>
        </div>

        <div class="product-info__features">
          <div class="product-info__feature">
            <div class="product-info__feature-icon">üöö</div>
            <div>
              <strong>Fast Delivery</strong>
              <p>Quick, reliable shipping to any location.</p>
            </div>
          </div>
          <div class="product-info__feature">
            <div class="product-info__feature-icon">‚Ü©Ô∏è</div>
            <div>
              <strong>Free & easy returns</strong>
              <p>Return this item by mail within 14 days for a full refund.</p>
            </div>
          </div>
        </div>

        <!-- Collapsible Sections -->
        <div class="product-accordion">
          <details class="product-accordion__item">
            <summary class="product-accordion__header">Description</summary>
            <div class="product-accordion__content">
              {{ product.description }}
            </div>
          </details>
          <details class="product-accordion__item">
            <summary class="product-accordion__header">Additional information</summary>
            <div class="product-accordion__content">
              <p><strong>SKU:</strong> {{ product.selected_or_first_available_variant.sku | default: 'N/A' }}</p>
              <p><strong>Vendor:</strong> {{ product.vendor }}</p>
              <p><strong>Type:</strong> {{ product.type }}</p>
              {% for tag in product.tags %}
                <span class="product-tag">{{ tag }}</span>
              {% endfor %}
            </div>
          </details>
          <details class="product-accordion__item">
            <summary class="product-accordion__header">Reviews</summary>
            <div class="product-accordion__content">
              <p>No reviews yet. Be the first to review this product!</p>
            </div>
          </details>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Related Products -->
<section class="related-products">
  <div class="page-width">
    <h2 class="related-products__title">Related products</h2>
    <div class="related-products__grid">
      {% assign related_collection = product.collections.first %}
      {% if related_collection %}
        {% for related_product in related_collection.products limit: 4 %}
          {% unless related_product.id == product.id %}
            {% render 'product-card', product: related_product, index: forloop.index %}
          {% endunless %}
        {% endfor %}
      {% else %}
        {% for related_product in collections.all.products limit: 4 %}
          {% unless related_product.id == product.id %}
            {% render 'product-card', product: related_product, index: forloop.index %}
          {% endunless %}
        {% endfor %}
      {% endif %}
    </div>
  </div>
</section>

<script>
function changeProductQty(delta) {
  const input = document.getElementById('productQtyInput');
  const val = parseInt(input.value) + delta;
  if (val >= 1) input.value = val;
}

document.querySelectorAll('.product-gallery__thumb').forEach(thumb => {
  thumb.addEventListener('click', function() {
    const main = document.getElementById('mainProductImage');
    if (main) {
      main.src = this.dataset.image;
      document.querySelectorAll('.product-gallery__thumb').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
    }
  });
});
</script>
